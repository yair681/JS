# הארנק הכיתתי - מערכת מתקדמת לניהול כיתות

## שינויים חדשים במערכת

### 1. **מערכת כיתות מרובות**
- המערכת תומכת כעת במספר כיתות במקביל
- כל כיתה מנוהלת בנפרד עם תלמידים, מורים, מוצרים וקניות משלה

### 2. **הרשאות משתמשים**

#### מנהלי-על (Super Admins)
שני מנהלי-על עם גישה מלאה:
- **יאיר פריש** - סיסמה: `prha12345`
- **יאיר פרץ** - סיסמה: `yair2589`

הרשאות מנהל-על:
- צפייה בכל הכיתות במערכת
- יצירת ומחיקת כיתות
- הוספת והסרת תלמידים ומורים מכל כיתה
- ניהול החנות הכיתתית של כל כיתה
- כל פעולה שמורה יכול לבצע

#### מורים
- מורה יכול לגשת רק לכיתה שלו
- יכול להוסיף ולמחוק תלמידים בכיתה שלו
- יכול לנהל נקודות התלמידים
- יכול לנהל את החנות הכיתתית (הוספה/מחיקה של מוצרים)
- יכול לאשר או לדחות בקשות קנייה

#### תלמידים
- תלמיד יכול לגשת רק לכיתה שלו
- יכול לצפות ביתרה האישית שלו
- יכול לרכוש מוצרים מהחנות הכיתתית
- יכול לראות את ההיסטוריה של הקניות שלו

### 3. **התחברות פשוטה**
- הוסר תיבת הבחירה "מורה/תלמיד"
- כל משתמש מזין רק את הסיסמה האישית שלו
- המערכת מזהה אוטומטית את סוג המשתמש והכיתה שלו

### 4. **דפים חדשים**

#### `superadmin.html`
- דף ראשי למנהלי-על
- מציג רשימת כל הכיתות
- מאפשר יצירת ומחיקת כיתות

#### `class-management.html`
- דף ניהול כיתה ספציפית למנהלי-על
- מציג תלמידים ומורים בכיתה
- מאפשר הוספה/הסרה של תלמידים ומורים
- גישה לניהול החנות הכיתתית

### 5. **שינויים בדפים קיימים**

#### `index.html`
- עיצוב חדש ומודרני
- שדה סיסמה יחיד לכל המשתמשים
- זיהוי אוטומטי של סוג משתמש

#### `admin.html`
- עבר לעבוד עם מזהי MongoDB (`_id`) במקום קודי תלמיד
- מציג רק תלמידים מהכיתה של המורה
- הסרת אפשרות ליצור מורים (רק מנהלי-על יכולים)

#### `shop-admin.html`
- עבר לעבוד עם כיתות
- מציג רק מוצרים וקניות של הכיתה המתאימה
- תומך בגישה של מנהלי-על

#### `student.html` & `shop-student.html`
- עברו לעבוד עם מזהי MongoDB
- מציגים רק נתונים מהכיתה של התלמיד

### 6. **שינויים ב-API (server.js)**

#### נקודות קצה חדשות:
- `GET /api/classes` - קבלת רשימת כיתות
- `POST /api/classes` - יצירת כיתה חדשה
- `DELETE /api/classes/:id` - מחיקת כיתה
- `GET /api/classes/:id` - קבלת פרטי כיתה מסוימת
- `DELETE /api/teachers/:id` - מחיקת מורה

#### נקודות קצה שהשתנו:
- כל נקודות הקצה עבדו עם `classId` כדי לסנן נתונים לפי כיתה
- `POST /api/login` - זיהוי אוטומטי של סוג משתמש
- `GET /api/students` - מקבל `classId` בפרמטר query
- `POST /api/create-student` - דורש `classId`
- `POST /api/create-teacher` - דורש `classId`
- `GET /api/products` - מסנן לפי `classId`
- `POST /api/products` - דורש `classId`
- `GET /api/purchases` - מסנן לפי `classId`
- `DELETE /api/purchases` - מוחק רק קניות של כיתה מסוימת

### 7. **שינויים במסד הנתונים**

#### סכמות חדשות:
```javascript
// Class Schema
{
  name: String,
  description: String,
  createdAt: Date
}
```

#### סכמות ששונו:
```javascript
// Student Schema
{
  password: String,      // שונה מ-id
  name: String,
  balance: Number,
  classId: ObjectId      // חדש
}

// Teacher Schema
{
  password: String,
  name: String,
  classId: ObjectId      // חדש
}

// Product Schema
{
  // ... שדות קיימים
  classId: ObjectId      // חדש
}

// Purchase Schema
{
  studentId: ObjectId,   // שונה לObjectId
  // ... שדות קיימים
  classId: ObjectId      // חדש
}
```

## התקנה והרצה

1. וודא שכל החבילות מותקנות:
```bash
npm install
```

2. וודא שיש לך קובץ `.env` עם:
```
MONGO_URI=your_mongodb_connection_string
PORT=3000
```

3. הרץ את השרת:
```bash
node server.js
```

4. גש לדפדפן ב: `http://localhost:3000`

## התחברות ראשונית

### מנהל-על:
- סיסמה: `prha12345` (יאיר פריש)
- סיסמה: `yair2589` (יאיר פרץ)

### מורה:
- צריך להיווצר על ידי מנהל-על תחילה

### תלמיד:
- צריך להיווצר על ידי מורה או מנהל-על תחילה

## הערות חשובות

1. **מיגרציה של נתונים קיימים**: אם יש לך נתונים קיימים, תצטרך:
   - ליצור כיתה ראשונית
   - להעביר את כל התלמידים והמורים הקיימים לכיתה זו
   - לעדכן את השדות `id` ל-`password` בתלמידים

2. **אבטחה**: סיסמאות מנהלי-על מוגדרות בקוד. בסביבת ייצור מומלץ:
   - להעביר אותן למשתני סביבה
   - להוסיף הצפנה
   - להוסיף אימות דו-שלבי

3. **גיבוי**: תמיד גבה את מסד הנתונים לפני שינויים גדולים!
